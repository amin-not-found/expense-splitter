import{w as C}from"./index-263b6c91.js";class B{constructor(){this.config=new Map}get darkTheme(){const t=localStorage.getItem("dark");return!!(t&&t==="true")}toggleTheme(){localStorage.setItem("dark",(!this.darkTheme).toString())}}var $=M;function M(e){let t=e;var r={}.toString.call(e).slice(8,-1);if(r=="Set")return new Set([...e].map(n=>M(n)));if(r=="Map")return new Map([...e].map(n=>[M(n[0]),M(n[1])]));if(r=="Date")return new Date(e.getTime());if(r=="RegExp")return RegExp(e.source,V(e));if(r=="Array"||r=="Object"){t=Array.isArray(e)?[]:{};for(var s in e)t[s]=M(e[s])}return t}function V(e){if(typeof e.source.flags=="string")return e.source.flags;var t=[];return e.global&&t.push("g"),e.ignoreCase&&t.push("i"),e.multiline&&t.push("m"),e.sticky&&t.push("y"),e.unicode&&t.push("u"),t.join("")}var L=20,j=1,x=1e6,T=1e6,H=-7,J=21,X=!1,N="[big.js] ",w=N+"Invalid ",D=w+"decimal places",W=w+"rounding mode",O=N+"Division by zero",f={},m=void 0,Z=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function U(){function e(t){var r=this;if(!(r instanceof e))return t===m?U():new e(t);if(t instanceof e)r.s=t.s,r.e=t.e,r.c=t.c.slice();else{if(typeof t!="string"){if(e.strict===!0&&typeof t!="bigint")throw TypeError(w+"value");t=t===0&&1/t<0?"-0":String(t)}G(r,t)}r.constructor=e}return e.prototype=f,e.DP=L,e.RM=j,e.NE=H,e.PE=J,e.strict=X,e.roundDown=0,e.roundHalfUp=1,e.roundHalfEven=2,e.roundUp=3,e}function G(e,t){var r,s,n;if(!Z.test(t))throw Error(w+"number");for(e.s=t.charAt(0)=="-"?(t=t.slice(1),-1):1,(r=t.indexOf("."))>-1&&(t=t.replace(".","")),(s=t.search(/e/i))>0?(r<0&&(r=s),r+=+t.slice(s+1),t=t.substring(0,s)):r<0&&(r=t.length),n=t.length,s=0;s<n&&t.charAt(s)=="0";)++s;if(s==n)e.c=[e.e=0];else{for(;n>0&&t.charAt(--n)=="0";);for(e.e=r-s-1,e.c=[],r=0;s<=n;)e.c[r++]=+t.charAt(s++)}return e}function v(e,t,r,s){var n=e.c;if(r===m&&(r=e.constructor.RM),r!==0&&r!==1&&r!==2&&r!==3)throw Error(W);if(t<1)s=r===3&&(s||!!n[0])||t===0&&(r===1&&n[0]>=5||r===2&&(n[0]>5||n[0]===5&&(s||n[1]!==m))),n.length=1,s?(e.e=e.e-t+1,n[0]=1):n[0]=e.e=0;else if(t<n.length){if(s=r===1&&n[t]>=5||r===2&&(n[t]>5||n[t]===5&&(s||n[t+1]!==m||n[t-1]&1))||r===3&&(s||!!n[0]),n.length=t,s){for(;++n[--t]>9;)if(n[t]=0,t===0){++e.e,n.unshift(1);break}}for(t=n.length;!n[--t];)n.pop()}return e}function _(e,t,r){var s=e.e,n=e.c.join(""),i=n.length;if(t)n=n.charAt(0)+(i>1?"."+n.slice(1):"")+(s<0?"e":"e+")+s;else if(s<0){for(;++s;)n="0"+n;n="0."+n}else if(s>0)if(++s>i)for(s-=i;s--;)n+="0";else s<i&&(n=n.slice(0,s)+"."+n.slice(s));else i>1&&(n=n.charAt(0)+"."+n.slice(1));return e.s<0&&r?"-"+n:n}f.abs=function(){var e=new this.constructor(this);return e.s=1,e};f.cmp=function(e){var t,r=this,s=r.c,n=(e=new r.constructor(e)).c,i=r.s,u=e.s,o=r.e,a=e.e;if(!s[0]||!n[0])return s[0]?i:n[0]?-u:0;if(i!=u)return i;if(t=i<0,o!=a)return o>a^t?1:-1;for(u=(o=s.length)<(a=n.length)?o:a,i=-1;++i<u;)if(s[i]!=n[i])return s[i]>n[i]^t?1:-1;return o==a?0:o>a^t?1:-1};f.div=function(e){var t=this,r=t.constructor,s=t.c,n=(e=new r(e)).c,i=t.s==e.s?1:-1,u=r.DP;if(u!==~~u||u<0||u>x)throw Error(D);if(!n[0])throw Error(O);if(!s[0])return e.s=i,e.c=[e.e=0],e;var o,a,c,g,h,d=n.slice(),k=o=n.length,F=s.length,l=s.slice(0,o),p=l.length,P=e,A=P.c=[],R=0,b=u+(P.e=t.e-e.e)+1;for(P.s=i,i=b<0?0:b,d.unshift(0);p++<o;)l.push(0);do{for(c=0;c<10;c++){if(o!=(p=l.length))g=o>p?1:-1;else for(h=-1,g=0;++h<o;)if(n[h]!=l[h]){g=n[h]>l[h]?1:-1;break}if(g<0){for(a=p==o?n:d;p;){if(l[--p]<a[p]){for(h=p;h&&!l[--h];)l[h]=9;--l[h],l[p]+=10}l[p]-=a[p]}for(;!l[0];)l.shift()}else break}A[R++]=g?c:++c,l[0]&&g?l[p]=s[k]||0:l=[s[k]]}while((k++<F||l[0]!==m)&&i--);return!A[0]&&R!=1&&(A.shift(),P.e--,b--),R>b&&v(P,b,r.RM,l[0]!==m),P};f.eq=function(e){return this.cmp(e)===0};f.gt=function(e){return this.cmp(e)>0};f.gte=function(e){return this.cmp(e)>-1};f.lt=function(e){return this.cmp(e)<0};f.lte=function(e){return this.cmp(e)<1};f.minus=f.sub=function(e){var t,r,s,n,i=this,u=i.constructor,o=i.s,a=(e=new u(e)).s;if(o!=a)return e.s=-a,i.plus(e);var c=i.c.slice(),g=i.e,h=e.c,d=e.e;if(!c[0]||!h[0])return h[0]?e.s=-a:c[0]?e=new u(i):e.s=1,e;if(o=g-d){for((n=o<0)?(o=-o,s=c):(d=g,s=h),s.reverse(),a=o;a--;)s.push(0);s.reverse()}else for(r=((n=c.length<h.length)?c:h).length,o=a=0;a<r;a++)if(c[a]!=h[a]){n=c[a]<h[a];break}if(n&&(s=c,c=h,h=s,e.s=-e.s),(a=(r=h.length)-(t=c.length))>0)for(;a--;)c[t++]=0;for(a=t;r>o;){if(c[--r]<h[r]){for(t=r;t&&!c[--t];)c[t]=9;--c[t],c[r]+=10}c[r]-=h[r]}for(;c[--a]===0;)c.pop();for(;c[0]===0;)c.shift(),--d;return c[0]||(e.s=1,c=[d=0]),e.c=c,e.e=d,e};f.mod=function(e){var t,r=this,s=r.constructor,n=r.s,i=(e=new s(e)).s;if(!e.c[0])throw Error(O);return r.s=e.s=1,t=e.cmp(r)==1,r.s=n,e.s=i,t?new s(r):(n=s.DP,i=s.RM,s.DP=s.RM=0,r=r.div(e),s.DP=n,s.RM=i,this.minus(r.times(e)))};f.neg=function(){var e=new this.constructor(this);return e.s=-e.s,e};f.plus=f.add=function(e){var t,r,s,n=this,i=n.constructor;if(e=new i(e),n.s!=e.s)return e.s=-e.s,n.minus(e);var u=n.e,o=n.c,a=e.e,c=e.c;if(!o[0]||!c[0])return c[0]||(o[0]?e=new i(n):e.s=n.s),e;if(o=o.slice(),t=u-a){for(t>0?(a=u,s=c):(t=-t,s=o),s.reverse();t--;)s.push(0);s.reverse()}for(o.length-c.length<0&&(s=c,c=o,o=s),t=c.length,r=0;t;o[t]%=10)r=(o[--t]=o[t]+c[t]+r)/10|0;for(r&&(o.unshift(r),++a),t=o.length;o[--t]===0;)o.pop();return e.c=o,e.e=a,e};f.pow=function(e){var t=this,r=new t.constructor("1"),s=r,n=e<0;if(e!==~~e||e<-T||e>T)throw Error(w+"exponent");for(n&&(e=-e);e&1&&(s=s.times(t)),e>>=1,!!e;)t=t.times(t);return n?r.div(s):s};f.prec=function(e,t){if(e!==~~e||e<1||e>x)throw Error(w+"precision");return v(new this.constructor(this),e,t)};f.round=function(e,t){if(e===m)e=0;else if(e!==~~e||e<-x||e>x)throw Error(D);return v(new this.constructor(this),e+this.e+1,t)};f.sqrt=function(){var e,t,r,s=this,n=s.constructor,i=s.s,u=s.e,o=new n("0.5");if(!s.c[0])return new n(s);if(i<0)throw Error(N+"No square root");i=Math.sqrt(s+""),i===0||i===1/0?(t=s.c.join(""),t.length+u&1||(t+="0"),i=Math.sqrt(t),u=((u+1)/2|0)-(u<0||u&1),e=new n((i==1/0?"5e":(i=i.toExponential()).slice(0,i.indexOf("e")+1))+u)):e=new n(i+""),u=e.e+(n.DP+=4);do r=e,e=o.times(r.plus(s.div(r)));while(r.c.slice(0,u).join("")!==e.c.slice(0,u).join(""));return v(e,(n.DP-=4)+e.e+1,n.RM)};f.times=f.mul=function(e){var t,r=this,s=r.constructor,n=r.c,i=(e=new s(e)).c,u=n.length,o=i.length,a=r.e,c=e.e;if(e.s=r.s==e.s?1:-1,!n[0]||!i[0])return e.c=[e.e=0],e;for(e.e=a+c,u<o&&(t=n,n=i,i=t,c=u,u=o,o=c),t=new Array(c=u+o);c--;)t[c]=0;for(a=o;a--;){for(o=0,c=u+a;c>a;)o=t[c]+i[a]*n[c-a-1]+o,t[c--]=o%10,o=o/10|0;t[c]=o}for(o?++e.e:t.shift(),a=t.length;!t[--a];)t.pop();return e.c=t,e};f.toExponential=function(e,t){var r=this,s=r.c[0];if(e!==m){if(e!==~~e||e<0||e>x)throw Error(D);for(r=v(new r.constructor(r),++e,t);r.c.length<e;)r.c.push(0)}return _(r,!0,!!s)};f.toFixed=function(e,t){var r=this,s=r.c[0];if(e!==m){if(e!==~~e||e<0||e>x)throw Error(D);for(r=v(new r.constructor(r),e+r.e+1,t),e=e+r.e+1;r.c.length<e;)r.c.push(0)}return _(r,!1,!!s)};f[Symbol.for("nodejs.util.inspect.custom")]=f.toJSON=f.toString=function(){var e=this,t=e.constructor;return _(e,e.e<=t.NE||e.e>=t.PE,!!e.c[0])};f.toNumber=function(){var e=Number(_(this,!0,!0));if(this.constructor.strict===!0&&!this.eq(e.toString()))throw Error(N+"Imprecise conversion");return e};f.toPrecision=function(e,t){var r=this,s=r.constructor,n=r.c[0];if(e!==m){if(e!==~~e||e<1||e>x)throw Error(w+"precision");for(r=v(new s(r),e,t);r.c.length<e;)r.c.push(0)}return _(r,e<=r.e||r.e<=s.NE||r.e>=s.PE,!!n)};f.valueOf=function(){var e=this,t=e.constructor;if(t.strict===!0)throw Error(N+"valueOf disallowed");return _(e,e.e<=t.NE||e.e>=t.PE,!0)};var I=U();function*K(e,t){for(;e<=t;++e)yield e}function Q(e){return e[e.length-1]}function*Y(e,t,r=[]){const s=r.length;if(s===t){yield r;return}for(const n of K(s?Q(r)+1:0,e-t+s))yield*Y(e,t,r.concat(n))}function*y(e,t){for(const r of Y(e.length,t))yield r.map(s=>e[s])}class S{constructor(t,r=0,s="",...n){this.name=t,this.amount=r,this.payer=s,this.debtors=new Set(n)}}class ee{constructor(t,r,s){this.giver=t,this.reciver=r,this.amount=s}}class z{constructor(t=new Set){this.people=t,this.expenses=[]}addPerson(t){return t?this.people.has(t)?`A person with name "${t}" already exists`:(this.people.add(t),null):"Person name can't be empty."}removePerson(t){for(let r=0;r<this.expenses.length;r++){const s=this.expenses[r];s.debtors.delete(t),s.payer===t&&(this.expenses.splice(r,1),r--)}this.people.delete(t)}addExpense(t){const r=this.validateExpense(t);if(r)return r;if(this.expenses.some(s=>s.name===t.name))return`An expense with "${t.name}" as name already exists`;this.expenses=[...this.expenses,t]}replaceExpense(t,r){const s=this.validateExpense(r);if(s)return s;const n=this.expenses.findIndex(i=>i.name==t);if(n<0)return`Expense with ${t} as name doesn't exist`;this.expenses.splice(n,1,r)}deleteExpense(t){const r=this.expenses.findIndex(s=>s.name==t);if(r<0)return`Expense with ${t} as name name doesn't exist`;this.expenses.splice(r,1)}validateExpense(t){if(!t.payer)return"Please select someone as the payer";if(!t.amount)return"Please enter an amount for the expense";if(!t.debtors.size)return"Please enter at least one debtor";if(t.debtors.size==1&&t.debtors.has(t.payer))return"There should be at least one debtor other than the payer"}getNetBalances(){const t=new Map;this.people.forEach(r=>t.set(r,I(0)));for(const r of this.expenses){const s=I(r.amount);t.set(r.payer,t.get(r.payer).minus(s));const n=s.div(r.debtors.size);r.debtors.forEach(i=>t.set(i,t.get(i).add(n)))}return t}naiveSettle(t){const r=[];for(;t.length>1;){const s=t.length-1,n=t[s].name,i=t[0].name;let u=0;switch(t[0].amount.abs().cmp(t[s].amount.abs())){case 0:u=t[s].amount.toNumber(),t.splice(s,1),t.splice(0,1);break;case-1:u=t[0].amount.abs().toNumber(),t[s].amount=t[s].amount.add(t[0].amount),t.splice(0,1);break;case 1:u=t[s].amount.toNumber(),t[0].amount=t[0].amount.add(t[s].amount),t.splice(s,1);break}r.push(new ee(n,i,u))}return r}settleBalances(t){const r=[];t=t.filter(i=>!i.amount.eq(0)),t=t.sort((i,u)=>i.amount.minus(u.amount).toNumber());let s=t.length,n=2;for(;n<s-2;){let i,u;for(const o of y(t,n)){if(i=!1,u=o.reduce((a,c)=>a.add(c.amount),I(0)),u.eq(0)){r.concat(this.naiveSettle(o));for(const a of o)t.splice(t.indexOf(a),1),--s,i=!0}if(i){--n;break}}++n}return r.concat(this.naiveSettle(t))}evaluate(){const t=Array.from(this.getNetBalances(),([r,s])=>({name:r,amount:s}));return this.settleBalances(t)}}var E=(e=>(e[e.None=0]="None",e[e.CreateExpense=1]="CreateExpense",e[e.EditExpense=2]="EditExpense",e[e.ShowExpense=3]="ShowExpense",e[e.DeleteExpense=4]="DeleteExpense",e[e.RemovePerson=5]="RemovePerson",e))(E||{});class q{constructor(t=new z,r=E.None,s=[],n=null,i=null){this.splitter=t,this._mode=r,this._data=s,this._currentExpense=n,this._backupExpense=i}get mode(){return this._mode}get data(){return this._data}get expenses(){return this.splitter.expenses}get people(){return this.splitter.people}get currentExpense(){return this._currentExpense}setState(t,r){this._mode=t,this._data=r}setNormalState(){this.setState(E.None,[])}addPerson(t){return this.splitter.addPerson(t)}removePerson(t){return this.setState(E.RemovePerson,[t])}createExpense(){this._currentExpense||(this._currentExpense=new S(this.expenses.length.toString())),this.setState(E.CreateExpense,[])}submitExpense(){let t;if(!this._currentExpense)return"Something went wrong";switch(this._mode){case E.CreateExpense:t=this.splitter.addExpense(this._currentExpense);break;case E.EditExpense:t=this.splitter.replaceExpense(this._data[0],this._currentExpense);break}if(t)return t;this.flushExpenseMemory(),this.setNormalState()}editExpense(t){this._backupExpense=this._currentExpense,this._currentExpense=$(t),this.setState(E.EditExpense,[t.name])}deleteExpenses(...t){this.setState(E.DeleteExpense,t)}confirmDelete(){switch(this._mode){case E.DeleteExpense:this._data.forEach(t=>{this.splitter.deleteExpense(t)});break;case E.RemovePerson:this._data.forEach(t=>this.splitter.removePerson(t));break;default:return}}flushExpenseMemory(){this._currentExpense=this._backupExpense,this._backupExpense=null}dismissModal(){this._mode==E.EditExpense&&this.flushExpenseMemory(),this.setNormalState()}evaluate(){var s;const t=new Map;for(const n of this.splitter.people)t.set(n,[]);const r=this.splitter.evaluate();for(const n of r)(s=t.get(n.giver))==null||s.push(n);return t}}function te(){const e=new z;e.addPerson("MEe"),e.addPerson("MEe2"),e.addPerson("YoU"),e.addPerson("ThEy"),e.addPerson("uS");let t;return t=new S("test",1e4,"MEe","MEe2"),e.addExpense(t),t=new S("test1",1e4,"MEe2","MEe2","YoU"),e.addExpense(t),t=new S("test2",347800,"YoU","MEe","MEe2","YoU","uS","ThEy"),e.addExpense(t),t=new S("test3",123456,"ThEy","MEe","MEe2","YoU"),e.addExpense(t),t=new S("test4",123456,"uS","ThEy","MEe","MEe2","YoU"),e.addExpense(t),e}function re(){const{subscribe:e,update:t}=C(new q(te())),r=n=>(...i)=>{let u;return t(o=>(u=o[n](...i),o)),u};new q;const s={addPerson:r("addPerson"),removePerson:r("removePerson"),createExpense:r("createExpense"),submitExpense:r("submitExpense"),editExpense:r("editExpense"),deleteExpenses:r("deleteExpenses"),confirmDelete:r("confirmDelete"),dismissModal:r("dismissModal"),evaluate:r("evaluate")};return{subscribe:e,...s}}function se(){const{subscribe:e,update:t}=C(new B),r=n=>(...i)=>{let u;return t(o=>(u=o[n](...i),localStorage.setItem("",JSON.stringify([...o.config.entries()])),o)),u};new B;const s={toggleTheme:r("toggleTheme")};return{subscribe:e,...s}}const ie=re(),oe=se();export{E as M,oe as c,ie as m};
